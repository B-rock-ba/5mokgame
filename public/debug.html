<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Debug</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        .info { margin: 10px 0; padding: 10px; background: #2a2a2a; }
        button { padding: 10px 20px; margin: 5px; background: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background: #45a049; }
        #log { margin-top: 20px; padding: 10px; background: #2a2a2a; min-height: 200px; }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .info-text { color: #00aaff; }
    </style>
</head>
<body>
    <h1>üîç WebSocket Connection Debug</h1>
    
    <div class="info">
        <strong>ÌòÑÏû¨ ÌéòÏù¥ÏßÄ Ï†ïÎ≥¥:</strong><br>
        <div id="pageInfo"></div>
    </div>
    
    <div class="info">
        <strong>ÏÉùÏÑ±Îêú WebSocket URL:</strong><br>
        <div id="wsUrl" class="info-text"></div>
    </div>
    
    <button onclick="testConnection()">WebSocket Ïó∞Í≤∞ ÌÖåÏä§Ìä∏</button>
    <button onclick="clearLog()">Î°úÍ∑∏ ÏßÄÏö∞Í∏∞</button>
    
    <div id="log"></div>
    
    <script>
        const log = document.getElementById('log');
        const pageInfo = document.getElementById('pageInfo');
        const wsUrlDiv = document.getElementById('wsUrl');
        
        function addLog(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `[${time}] ${message}`;
            log.appendChild(div);
            log.scrollTop = log.scrollHeight;
        }
        
        function clearLog() {
            log.innerHTML = '';
        }
        
        function getWebSocketURL() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const hostname = window.location.hostname;
            
            // GitHub Codespaces environment
            if (hostname.includes('.app.github.dev')) {
                const hostParts = hostname.split('.');
                const nameAndPort = hostParts[0];
                const nameWithoutPort = nameAndPort.split('-').slice(0, -1).join('-');
                const newHostname = `${nameWithoutPort}-8080.${hostParts.slice(1).join('.')}`;
                return `${protocol}//${newHostname}`;
            }
            
            // Local development
            return `${protocol}//${hostname}:8080`;
        }
        
        // ÌéòÏù¥ÏßÄ Ï†ïÎ≥¥ ÌëúÏãú
        pageInfo.innerHTML = `
            Protocol: ${window.location.protocol}<br>
            Hostname: ${window.location.hostname}<br>
            Port: ${window.location.port}<br>
            Full Host: ${window.location.host}<br>
            Is Codespaces: ${window.location.hostname.includes('.app.github.dev')}
        `;
        
        const wsUrl = getWebSocketURL();
        wsUrlDiv.textContent = wsUrl;
        addLog('ÌéòÏù¥ÏßÄ Î°úÎìúÎê®', 'success');
        addLog(`WebSocket URL ÏÉùÏÑ±: ${wsUrl}`, 'info-text');
        
        function testConnection() {
            addLog('Ïó∞Í≤∞ ÏãúÎèÑ Ï§ë...', 'info-text');
            
            const ws = new WebSocket(wsUrl);
            
            ws.onopen = () => {
                addLog('‚úÖ Ïó∞Í≤∞ ÏÑ±Í≥µ!', 'success');
                ws.send(JSON.stringify({ type: 'HOST_JOIN' }));
                addLog('HOST_JOIN Î©îÏãúÏßÄ Ï†ÑÏÜ°', 'info-text');
            };
            
            ws.onmessage = (event) => {
                addLog(`üì© Î©îÏãúÏßÄ ÏàòÏã†: ${event.data}`, 'success');
            };
            
            ws.onerror = (error) => {
                addLog(`‚ùå Ïó∞Í≤∞ Ïò§Î•ò Î∞úÏÉù`, 'error');
                console.error('WebSocket error:', error);
            };
            
            ws.onclose = (event) => {
                addLog(`üîå Ïó∞Í≤∞ Ï¢ÖÎ£å (ÏΩîÎìú: ${event.code}, ÏÇ¨Ïú†: ${event.reason || 'ÏóÜÏùå'})`, 'error');
            };
            
            // 5Ï¥à ÌõÑ ÏûêÎèô Ï¢ÖÎ£å
            setTimeout(() => {
                if (ws.readyState === WebSocket.OPEN) {
                    addLog('ÌÖåÏä§Ìä∏ ÏôÑÎ£å, Ïó∞Í≤∞ Ï¢ÖÎ£å', 'info-text');
                    ws.close();
                }
            }, 5000);
        }
    </script>
</body>
</html>
